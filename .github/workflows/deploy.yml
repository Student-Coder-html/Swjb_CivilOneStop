name: Deploy Component Hub

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Fetch and Build Site
        env:
          GH_TOKEN: ${{ secrets.COMPONENT_HUB_TOKEN }}
        run: |
          mkdir -p _site
          
          # Create a Node.js script to fetch all HTML files
          cat > fetch.js << 'FETCHJS'
          const https = require('https');
          const fs = require('fs');
          
          const TOKEN = process.env.GH_TOKEN;
          const REPO = process.env.GITHUB_REPOSITORY;
          
          async function fetchJSON(path) {
            return new Promise((resolve, reject) => {
              const options = {
                hostname: 'api.github.com',
                path: `/repos/${REPO}/contents/${encodeURIComponent(path)}`,
                headers: {
                  'User-Agent': 'GitHub-Actions',
                  'Authorization': `token ${TOKEN}`,
                  'Accept': 'application/vnd.github.v3+json'
                }
              };
              
              https.get(options, (res) => {
                let data = '';
                res.on('data', chunk => data += chunk);
                res.on('end', () => {
                  try {
                    resolve(JSON.parse(data));
                  } catch(e) {
                    console.error('Parse error for path:', path);
                    resolve(null);
                  }
                });
              }).on('error', reject);
            });
          }
          
          async function findHTMLFiles(path = '') {
            console.log('Scanning:', path || 'root');
            const contents = await fetchJSON(path);
            
            if (!Array.isArray(contents)) {
              console.log('Not a directory or error:', path);
              return [];
            }
            
            let htmlFiles = [];
            
            for (const item of contents) {
              if (item.type === 'file' && item.name.endsWith('.html')) {
                htmlFiles.push({
                  name: item.name,
                  path: item.path,
                  size: item.size,
                  html_url: item.html_url,
                  download_url: item.download_url
                });
                console.log('Found HTML:', item.path);
              } else if (item.type === 'dir') {
                const subFiles = await findHTMLFiles(item.path);
                htmlFiles = htmlFiles.concat(subFiles);
              }
            }
            
            return htmlFiles;
          }
          
          async function getRepoInfo() {
            return new Promise((resolve, reject) => {
              const options = {
                hostname: 'api.github.com',
                path: `/repos/${REPO}`,
                headers: {
                  'User-Agent': 'GitHub-Actions',
                  'Authorization': `token ${TOKEN}`,
                  'Accept': 'application/vnd.github.v3+json'
                }
              };
              
              https.get(options, (res) => {
                let data = '';
                res.on('data', chunk => data += chunk);
                res.on('end', () => resolve(JSON.parse(data)));
              }).on('error', reject);
            });
          }
          
          async function main() {
            console.log('Fetching HTML files...');
            const htmlFiles = await findHTMLFiles();
            console.log(`Total HTML files found: ${htmlFiles.length}`);
            
            fs.writeFileSync('_site/components.json', JSON.stringify(htmlFiles, null, 2));
            
            console.log('Fetching repo info...');
            const repoInfo = await getRepoInfo();
            fs.writeFileSync('_site/repo-info.json', JSON.stringify(repoInfo, null, 2));
            
            console.log('‚úÖ Data fetched successfully');
          }
          
          main().catch(console.error);
          FETCHJS
          
          # Run the fetch script
          node fetch.js
          
          # Show what we found
          echo "Components found:"
          cat _site/components.json | head -20
      
      - name: Generate HTML
        run: |
          cat > _site/index.html << 'HTMLEOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="description" content="Project: Swjb_CivilOneStop Asset Archive.">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Component Hub - Swjb_CivilOneStop</title>
              <style>
                  :root {
                      --bg-primary: #ffffff;
                      --bg-secondary: #f5f5f7;
                      --bg-tertiary: #ffffff;
                      --text-primary: #1d1d1f;
                      --text-secondary: #86868b;
                      --text-tertiary: #6e6e73;
                      --border-color: rgba(0, 0, 0, 0.08);
                      --accent-color: #007aff;
                      --accent-hover: #0051d5;
                      --card-bg: rgba(255, 255, 255, 0.8);
                      --card-border: rgba(0, 0, 0, 0.06);
                      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
                      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
                      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
                      --gradient-start: #007aff;
                      --gradient-end: #5856d6;
                  }
                  
                  [data-theme="dark"] {
                      --bg-primary: #000000;
                      --bg-secondary: #1c1c1e;
                      --bg-tertiary: #2c2c2e;
                      --text-primary: #f5f5f7;
                      --text-secondary: #98989d;
                      --text-tertiary: #86868b;
                      --border-color: rgba(255, 255, 255, 0.1);
                      --accent-color: #0a84ff;
                      --accent-hover: #409cff;
                      --card-bg: rgba(28, 28, 30, 0.8);
                      --card-border: rgba(255, 255, 255, 0.08);
                      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
                      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
                      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
                      --gradient-start: #0a84ff;
                      --gradient-end: #5e5ce6;
                  }

                  * { 
                      margin: 0; 
                      padding: 0; 
                      box-sizing: border-box; 
                  }
                  
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', 'Malgun Gothic', sans-serif;
                      background: var(--bg-secondary);
                      color: var(--text-primary);
                      line-height: 1.5;
                      transition: background-color 0.3s ease, color 0.3s ease;
                      -webkit-font-smoothing: antialiased;
                      -moz-osx-font-smoothing: grayscale;
                  }
                  
                  /* Loader */
                  #loader-overlay {
                      position: fixed;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      background: var(--bg-secondary);
                      z-index: 9999;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      transition: opacity 0.5s ease;
                      backdrop-filter: blur(20px);
                  }
                  
                  .loader-content {
                      text-align: center;
                      width: 300px;
                  }
                  
                  .loader-content .logo-icon {
                      width: 64px;
                      height: 64px;
                      background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
                      border-radius: 18px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-size: 32px;
                      margin: 0 auto 24px auto;
                      box-shadow: var(--shadow-md);
                  }
                  
                  .loader-content h3 {
                      font-size: 20px;
                      font-weight: 600;
                      color: var(--text-primary);
                      margin-bottom: 24px;
                      letter-spacing: -0.3px;
                  }
                  
                  .progress-bar-container {
                      width: 100%;
                      height: 4px;
                      background: var(--bg-tertiary);
                      border-radius: 2px;
                      overflow: hidden;
                      margin-bottom: 16px;
                  }
                  
                  .progress-bar-indeterminate {
                      position: relative;
                      width: 100%;
                      height: 100%;
                  }
                  
                  .progress-bar-indeterminate::before {
                      content: '';
                      position: absolute;
                      height: 100%;
                      width: 50%;
                      background: linear-gradient(90deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
                      border-radius: 2px;
                      animation: indeterminate-progress 1.5s infinite ease-in-out;
                  }
                  
                  .loader-log {
                      font-size: 13px;
                      color: var(--text-secondary);
                      font-family: 'SF Mono', 'Monaco', monospace;
                  }
                  
                  @keyframes indeterminate-progress {
                      0% { left: -50%; }
                      100% { left: 100%; }
                  }
                  
                  /* Header */
                  header {
                      background: var(--card-bg);
                      border-bottom: 1px solid var(--border-color);
                      position: sticky;
                      top: 0;
                      z-index: 100;
                      backdrop-filter: saturate(180%) blur(20px);
                  }
                  
                  .header-container {
                      max-width: 1400px;
                      margin: 0 auto;
                      padding: 20px 40px;
                      display: flex;
                      align-items: center;
                      justify-content: space-between;
                  }
                  
                  .logo {
                      font-size: 21px;
                      font-weight: 600;
                      color: var(--text-primary);
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      letter-spacing: -0.5px;
                  }
                  
                  .logo-icon {
                      width: 36px;
                      height: 36px;
                      background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
                      border-radius: 10px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-size: 20px;
                  }
                  
                  .header-links {
                      display: flex;
                      gap: 32px;
                      align-items: center;
                  }
                  
                  .header-link {
                      color: var(--text-secondary);
                      text-decoration: none;
                      font-size: 14px;
                      font-weight: 500;
                      transition: color 0.2s;
                  }
                  
                  .header-link:hover { 
                      color: var(--text-primary); 
                  }
                  
                  .theme-toggle {
                      background: var(--bg-tertiary);
                      border: 1px solid var(--border-color);
                      border-radius: 20px;
                      padding: 6px 16px;
                      cursor: pointer;
                      font-size: 13px;
                      font-weight: 500;
                      color: var(--text-primary);
                      transition: all 0.2s;
                      display: flex;
                      align-items: center;
                      gap: 6px;
                  }
                  
                  .theme-toggle:hover {
                      background: var(--bg-secondary);
                      transform: scale(1.02);
                  }
                  
                  /* Navigation */
                  nav {
                      background: var(--bg-primary);
                      border-bottom: 1px solid var(--border-color);
                  }
                  
                  .nav-container {
                      max-width: 1400px;
                      margin: 0 auto;
                      padding: 0 40px;
                      display: flex;
                      gap: 8px;
                  }
                  
                  .nav-item {
                      padding: 12px 20px;
                      cursor: pointer;
                      font-size: 14px;
                      font-weight: 500;
                      color: var(--text-secondary);
                      border-bottom: 2px solid transparent;
                      transition: all 0.2s;
                      letter-spacing: -0.2px;
                  }
                  
                  .nav-item:hover { 
                      color: var(--text-primary); 
                  }
                  
                  .nav-item.active {
                      color: var(--accent-color);
                      border-bottom-color: var(--accent-color);
                  }
                  
                  /* Main Content */
                  main {
                      max-width: 1400px;
                      margin: 0 auto;
                      padding: 64px 40px;
                  }
                  
                  .page-header { 
                      margin-bottom: 48px; 
                  }
                  
                  .page-title {
                      font-size: 56px;
                      font-weight: 700;
                      color: var(--text-primary);
                      margin-bottom: 16px;
                      letter-spacing: -1.5px;
                      background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
                      -webkit-background-clip: text;
                      -webkit-text-fill-color: transparent;
                      background-clip: text;
                  }
                  
                  .page-description {
                      font-size: 19px;
                      color: var(--text-secondary);
                      max-width: 600px;
                      line-height: 1.6;
                      letter-spacing: -0.2px;
                  }
                  
                  /* Search */
                  .search-container { 
                      margin-bottom: 48px; 
                  }
                  
                  .search-box {
                      position: relative;
                      max-width: 600px;
                  }
                  
                  .search-input {
                      width: 100%;
                      padding: 14px 20px 14px 48px;
                      border: 1px solid var(--border-color);
                      border-radius: 12px;
                      font-size: 15px;
                      transition: all 0.2s;
                      background: var(--card-bg);
                      color: var(--text-primary);
                      backdrop-filter: saturate(180%) blur(20px);
                  }
                  
                  .search-input::placeholder {
                      color: var(--text-tertiary);
                  }
                  
                  .search-input:focus {
                      outline: none;
                      border-color: var(--accent-color);
                      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
                  }
                  
                  [data-theme="dark"] .search-input:focus {
                      box-shadow: 0 0 0 4px rgba(10, 132, 255, 0.2);
                  }
                  
                  .search-icon {
                      position: absolute;
                      left: 18px;
                      top: 50%;
                      transform: translateY(-50%);
                      color: var(--text-tertiary);
                      font-size: 18px;
                  }
                  
                  /* Stats Bar */
                  .stats-bar {
                      display: flex;
                      gap: 40px;
                      margin-bottom: 32px;
                      padding: 20px 0;
                  }
                  
                  .stat-item {
                      display: flex;
                      align-items: baseline;
                      gap: 8px;
                      color: var(--text-secondary);
                      font-size: 14px;
                  }
                  
                  .stat-number {
                      font-weight: 600;
                      color: var(--text-primary);
                      font-size: 28px;
                      letter-spacing: -0.5px;
                  }
                  
                  /* Component Grid */
                  .component-grid {
                      display: grid;
                      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                      gap: 20px;
                  }
                  
                  .component-card {
                      background: var(--card-bg);
                      border: 1px solid var(--card-border);
                      border-radius: 16px;
                      padding: 24px;
                      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                      cursor: pointer;
                      position: relative;
                      overflow: hidden;
                      backdrop-filter: saturate(180%) blur(20px);
                  }
                  
                  .component-card::before {
                      content: '';
                      position: absolute;
                      top: 0;
                      left: 0;
                      right: 0;
                      height: 2px;
                      background: linear-gradient(90deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
                      transform: scaleX(0);
                      transition: transform 0.3s;
                  }
                  
                  .component-card:hover {
                      transform: translateY(-4px);
                      box-shadow: var(--shadow-lg);
                      border-color: var(--accent-color);
                  }
                  
                  .component-card:hover::before { 
                      transform: scaleX(1); 
                  }
                  
                  .component-icon {
                      width: 56px;
                      height: 56px;
                      background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
                      border-radius: 14px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-bottom: 20px;
                      font-size: 28px;
                      box-shadow: var(--shadow-sm);
                  }
                  
                  .component-name {
                      font-size: 17px;
                      font-weight: 600;
                      color: var(--text-primary);
                      margin-bottom: 8px;
                      letter-spacing: -0.3px;
                  }
                  
                  .component-path {
                      font-size: 12px;
                      color: var(--text-tertiary);
                      margin-bottom: 16px;
                      font-family: 'SF Mono', 'Monaco', monospace;
                      overflow: hidden;
                      text-overflow: ellipsis;
                      white-space: nowrap;
                  }
                  
                  .component-meta {
                      display: flex;
                      gap: 8px;
                      flex-wrap: wrap;
                      align-items: center;
                  }
                  
                  .component-tag {
                      background: var(--bg-tertiary);
                      color: var(--text-secondary);
                      padding: 4px 12px;
                      border-radius: 12px;
                      font-size: 12px;
                      font-weight: 500;
                      border: 1px solid var(--border-color);
                  }
                  
                  .component-size {
                      color: var(--text-tertiary);
                      font-size: 12px;
                      margin-left: auto;
                      font-family: 'SF Mono', 'Monaco', monospace;
                  }
                  
                  /* Empty State */
                  .empty-state {
                      grid-column: 1/-1;
                      text-align: center;
                      padding: 80px 20px;
                  }
                  
                  .empty-state-icon {
                      font-size: 64px;
                      margin-bottom: 16px;
                      opacity: 0.3;
                  }
                  
                  .empty-state-title {
                      font-size: 21px;
                      font-weight: 600;
                      color: var(--text-primary);
                      margin-bottom: 8px;
                      letter-spacing: -0.3px;
                  }
                  
                  .empty-state-text {
                      color: var(--text-secondary);
                      font-size: 15px;
                  }
                  
                  /* Footer */
                  footer {
                      background: var(--bg-primary);
                      border-top: 1px solid var(--border-color);
                      margin-top: 120px;
                  }
                  
                  .footer-container {
                      max-width: 1400px;
                      margin: 0 auto;
                      padding: 60px 40px 40px;
                  }
                  
                  .repo-info {
                      background: var(--bg-secondary);
                      padding: 24px;
                      border-radius: 12px;
                      margin-bottom: 48px;
                      border: 1px solid var(--border-color);
                  }
                  
                  .repo-info strong {
                      color: var(--text-primary);
                      font-weight: 600;
                  }
                  
                  .repo-info a {
                      color: var(--accent-color);
                      text-decoration: none;
                      font-weight: 500;
                  }
                  
                  .repo-info a:hover { 
                      text-decoration: underline; 
                  }
                  
                  .footer-bottom {
                      border-top: 1px solid var(--border-color);
                      padding-top: 32px;
                      text-align: center;
                      color: var(--text-secondary);
                      font-size: 13px;
                  }
                  
                  /* Responsive */
                  @media (max-width: 768px) {
                      .header-container, .nav-container, main, .footer-container {
                          padding-left: 20px;
                          padding-right: 20px;
                      }
                      .page-title { 
                          font-size: 40px; 
                      }
                      .component-grid { 
                          grid-template-columns: 1fr; 
                      }
                      .header-links { 
                          display: none; 
                      }
                      .loader-content { 
                          width: 90%; 
                      }
                      .stats-bar {
                          gap: 24px;
                      }
                  }
              </style>
          </head>
          <body>
              <div id="loader-overlay">
                  <div class="loader-content">
                      <div class="logo-icon">üì¶</div>
                      <h3>Loading CivilOneStop Hub</h3>
                      <div class="progress-bar-container">
                          <div class="progress-bar-indeterminate"></div>
                      </div>
                      <div class="loader-log" id="loaderLog">Initializing...</div>
                  </div>
              </div>
              
              <header>
                  <div class="header-container">
                      <div class="logo">
                          <div class="logo-icon">üì¶</div>
                          <span>CivilOneStop Hub</span>
                      </div>
                      <div class="header-links">
                          <a href="#" class="header-link" id="githubHeaderLink">GitHub</a>
                          <button class="theme-toggle" onclick="toggleTheme()">
                              <span id="themeIcon">üåô</span>
                              <span id="themeText">Dark</span>
                          </button>
                      </div>
                  </div>
              </header>
              
              <main>
                  <div class="page-header">
                      <h1 class="page-title">CivilOneStop Hub</h1>
                      <p class="page-description">
                          Project: Swjb_CivilOneStop Asset Archive. 
                      </p>
                  </div>
                  
                  <div class="search-container">
                      <div class="search-box">
                          <span class="search-icon">üîç</span>
                          <input type="text" class="search-input" id="searchInput" placeholder="Search components...">
                      </div>
                  </div>
                  
                  <div class="stats-bar" id="statsBar">
                      <div class="stat-item">
                          <span>Total</span>
                          <span class="stat-number" id="totalCount">0</span>
                          <span>components</span>
                      </div>
                      <div class="stat-item">
                          <span class="stat-number" id="categoryCount">0</span>
                          <span>in category</span>
                      </div>
                  </div>
                  
                  <div class="component-grid" id="componentGrid"></div>
              </main>
              
              <footer>
                  <div class="footer-container">
                      <div class="repo-info" id="repoInfo"></div>
                      <div class="footer-bottom">
                          <p>Project: CivilOneStop ¬∑ Built by @Special-Srit and @minjun0629</p>
                      </div>
                  </div>
              </footer>
              
              <script>
                  let allComponents = [];
                  let currentCategory = 'all';

                  // Theme Management
                  function initTheme() {
                      const savedTheme = localStorage.getItem('theme') || 'light';
                      document.documentElement.setAttribute('data-theme', savedTheme);
                      updateThemeButton(savedTheme);
                  }

                  function toggleTheme() {
                      const currentTheme = document.documentElement.getAttribute('data-theme');
                      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                      document.documentElement.setAttribute('data-theme', newTheme);
                      localStorage.setItem('theme', newTheme);
                      updateThemeButton(newTheme);
                  }

                  function updateThemeButton(theme) {
                      const icon = document.getElementById('themeIcon');
                      const text = document.getElementById('themeText');
                      if (theme === 'dark') {
                          icon.textContent = '‚òÄÔ∏è';
                          text.textContent = 'Light';
                      } else {
                          icon.textContent = 'üåô';
                          text.textContent = 'Dark';
                      }
                  }

                  function updateLoaderLog(message) {
                      const logEl = document.getElementById('loaderLog');
                      if (logEl) {
                          logEl.textContent = message;
                      }
                  }

                  function hideLoader() {
                      const loader = document.getElementById('loader-overlay');
                      if (loader) {
                          loader.style.opacity = '0';
                          setTimeout(() => {
                              loader.style.display = 'none';
                          }, 500);
                      }
                  }

                  function detectCategory(path) {
                      const lowerPath = path.toLowerCase();
                      if (lowerPath.includes('component')) return 'components';
                      return 'components';
                  }

                  function getIconForFile(name) {
                      const lowerName = name.toLowerCase();
                      if (lowerName.includes('header') || lowerName.includes('nav')) return 'üß≠';
                      if (lowerName.includes('footer')) return 'üîª';
                      if (lowerName.includes('form')) return 'üìù';
                      if (lowerName.includes('table')) return 'üìä';
                      if (lowerName.includes('modal')) return 'üí¨';
                      if (lowerName.includes('search')) return 'üîç';
                      if (lowerName.includes('card')) return 'üé¥';
                      if (lowerName.includes('button')) return 'üîò';
                      if (lowerName.includes('menu')) return '‚ò∞';
                      if (lowerName.includes('login')) return 'üîê';
                      return 'üìÑ';
                  }

                  function formatSize(bytes) {
                      if (bytes < 1024) return bytes + ' B';
                      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
                  }

                  async function init() {
                      initTheme();
                      const startTime = Date.now();
                      const minLoadTime = 1500;

                      try {
                          updateLoaderLog('Finding content path...');
                          let basePath = window.location.pathname;
                          if (basePath.endsWith('index.html')) {
                              basePath = basePath.substring(0, basePath.lastIndexOf('index.html'));
                          }
                          if (!basePath.endsWith('/')) {
                              basePath += '/';
                          }
                          
                          updateLoaderLog('Fetching component & repo data...');
                          const [componentsData, repoData] = await Promise.all([
                              fetch(basePath + 'components.json').then(r => r.json()),
                              fetch(basePath + 'repo-info.json').then(r => r.json())
                          ]);

                          updateLoaderLog('Processing data...');
                          
                          allComponents = componentsData.map(item => {
                              const pathParts = item.path.split('/');
                              let rootFolderLabel = null;

                              if (pathParts.length > 1 && !pathParts[0].startsWith('.')) {
                                  rootFolderLabel = pathParts[0];
                              }

                              return {
                                  name: item.name.replace('.html', ''),
                                  path: item.path,
                                  size: item.size,
                                  url: item.html_url,
                                  downloadUrl: item.download_url,
                                  category: detectCategory(item.path),
                                  icon: getIconForFile(item.name),
                                  rootLabel: rootFolderLabel
                              };
                          });

                          const repoUrl = repoData.html_url;
                          document.getElementById('githubHeaderLink').href = repoUrl;

                          document.getElementById('repoInfo').innerHTML = `
                              <strong>Repository:</strong> 
                              <a href="${repoData.html_url}" target="_blank">${repoData.full_name}</a>
                              ${repoData.description ? `<br><small>${repoData.description}</small>` : ''}
                          `;
                          
                          updateLoaderLog(`Found ${allComponents.length} components. Rendering...`);
                          updateStats(allComponents.length, allComponents.length);
                          renderComponents(allComponents);
                          
                          const elapsedTime = Date.now() - startTime;
                          const remainingTime = Math.max(0, minLoadTime - elapsedTime);
                          
                          setTimeout(() => {
                              hideLoader();
                          }, remainingTime);

                      } catch (error) {
                          console.error('Error:', error);
                          const elapsedTime = Date.now() - startTime;
                          const remainingTime = Math.max(0, minLoadTime - elapsedTime);

                          setTimeout(() => {
                              hideLoader(); 
                              document.getElementById('componentGrid').innerHTML = `
                                  <div class="empty-state">
                                      <div class="empty-state-icon">‚ö†Ô∏è</div>
                                      <div class="empty-state-title">Error loading components</div>
                                      <p class="empty-state-text">${error.message}. Check console for details.</p>
                                  </div>
                              `;
                          }, remainingTime);
                      }
                  }

                  function updateStats(total, filtered) {
                      document.getElementById('totalCount').textContent = total;
                      document.getElementById('categoryCount').textContent = filtered;
                  }

                  function renderComponents(componentsToRender) {
                      const grid = document.getElementById('componentGrid');
                      grid.innerHTML = '';

                      if (componentsToRender.length === 0) {
                          grid.innerHTML = `
                              <div class="empty-state">
                                  <div class="empty-state-icon">üîç</div>
                                  <div class="empty-state-title">No results found</div>
                                  <p class="empty-state-text">Try adjusting your search or filter</p>
                              </div>
                          `;
                          return;
                      }

                      componentsToRender.forEach(component => {
                          const card = document.createElement('div');
                          card.className = 'component-card';
                          card.onclick = () => window.open(component.url, '_blank');
                          
                          card.innerHTML = `
                              <div class="component-icon">${component.icon}</div>
                              <div class="component-name">${component.name}</div>
                              <div class="component-path">${component.path}</div>
                              <div class="component-meta">
                                  <span class="component-tag">${component.category}</span>
                                  ${component.rootLabel ? `<span class="component-tag">${component.rootLabel}</span>` : ''}
                                  <span class="component-size">${formatSize(component.size)}</span>
                              </div>
                          `;
                          
                          grid.appendChild(card);
                      });
                  }

                  function showCategory(category) {
                      currentCategory = category;
                      document.querySelectorAll('.nav-item').forEach(item => {
                          item.classList.remove('active');
                      });
                      event.target.classList.add('active');

                      const filtered = category === 'all'
                          ? allComponents
                          : allComponents.filter(c => c.category === category);

                      updateStats(allComponents.length, filtered.length);
                      renderComponents(filtered);
                  }

                  function searchComponents() {
                      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                      
                      const filtered = allComponents.filter(c =>
                          c.name.toLowerCase().includes(searchTerm) ||
                          c.path.toLowerCase().includes(searchTerm) ||
                          (c.rootLabel && c.rootLabel.toLowerCase().includes(searchTerm))
                      );
                      
                      updateStats(allComponents.length, filtered.length);
                      renderComponents(filtered);
                  }

                  document.getElementById('searchInput').addEventListener('input', searchComponents);
                  window.addEventListener('DOMContentLoaded', init);
              </script>
          </body>
          </html>
          HTMLEOF
          
          echo "‚úÖ HTML generated"
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4